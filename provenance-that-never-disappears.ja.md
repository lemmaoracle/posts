---
slug: "provenance-that-never-disappears"
date: "2026.02.28"
category: "Guides"
section: "Essays"
title: "消えることのない来歴"
abstract: "ドキュメントコミットメント、スキーマ、発行者、ZK 検証結果はオンチェーンにアンカーされます。RAG インデックスは再構築でき、埋め込みは再計算できますが、来歴レイヤーは永続します。"
---

## なぜオンチェーンの来歴か

オフチェーンデータベースは変更、削除、消失し得ます。バックアップはずれ、ログはローテーションされます。来歴メタデータがサーバー上にしか存在しなければ、保証は運用者の誠実さと稼働時間に依存するだけです。

Lemma が来歴をオンチェーンにアンカーするのは、ブロックチェーンの状態が追記専用で、公開監査可能で、単一障害点に耐えるからです。ドキュメントが登録された時点で、その来歴記録は永続的になります。

## 何がアンカーされるか

`LemmaRegistry` コントラクトは、登録された各ドキュメントについて以下を保存します：

- `docHash` — 暗号化ドキュメントの SHA3-256 ハッシュ。
- `attrCommitmentRoot` — 全属性コミットメントの Merkle ルート。
- `schemaIdHash` — 使用されたスキーマの識別子。
- 発行者およびサブジェクトの識別子。
- 失効データ（失効ルートとスキーム）。
- ZK 検証器コントラクトへのリンク。

ZK 証明が検証されると、検証器コントラクトは `docHash`、`circuitIdHash`、`generatorIdHash`、公開入力を含む `ProofVerified` イベントを発行します。このイベントはブロックチェーンのイベントログに永続的に記録されます。

## 信頼を失わずに再構築

アプリケーションは変わります。ベクトルデータベースは再インデックスされます。埋め込みモデルはアップグレードされます。RAG パイプラインはゼロから再構築されます。

これらはいずれも来歴に影響しません。信頼のアンカーがオンチェーンにあるため：

- RAG インデックスを再構築し、すべての属性を同じオンチェーンレコードに対して再検証できる。
- 新しい埋め込みモデルに移行しても再証明は不要 — 証明とその検証イベントはすでに永続的。
- オンチェーンイベントを再生して過去の主張を監査できる。

来歴レイヤーはアプリケーション層から分離されています。インフラは自由に進化できます。

## スマートコントラクトフック

Lemma はドキュメント登録時に実行されるオプションのスマートコントラクトフックをサポートします。これらのフックはレジストリが保存するものと同じ `DocumentProvenance` ペイロードを受け取ります。

これにより他のオンチェーンプロトコルとのコンポーザビリティが実現します — 登録されたドキュメントが自動的に DeFi アクション、アクセス制御リストの更新、下流コントラクトへの通知をトリガーでき、すべて同じ来歴データを使用します。

## トラストモデル

Lemma のトラスト境界は明確です：クライアント側コードを信頼しません。信頼するのは：

- ZK 証明とそのオンチェーン/オフチェーン検証。
- 暗号学的コミットメント。
- 発行者の BBS+ 署名。
- オンチェーンレジストリと検証器コントラクトの正当性。

クライアントが偽の正規化を送れば、ZK 証明は失敗します。保存されたドキュメントが改ざんされれば、`docHash` は一致しません。オンチェーンレコードが最終的な裁定者であり、それは決して消えません。
